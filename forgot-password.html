<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Quên mật khẩu - CodeLearn</title>

    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <style>
      :root {
        --bg: #0f2a44;
        --tile: #193a5f;
        --accent: #3ee2c0;
      }
      body {
        background: linear-gradient(135deg, #0b2238 0%, #1a365d 100%);
        min-height: 100vh;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      .nav-lite {
        background: rgba(11, 34, 56, 0.9);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
      .nav-lite .nav-link {
        color: #cfe2ff;
      }
      .nav-lite .nav-link:hover {
        color: #fff;
      }

      .forgot-container {
        min-height: calc(100vh - 80px);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem 0;
      }

      .forgot-card {
        background: rgba(255, 255, 255, 0.98);
        border: none;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        max-width: 450px;
        width: 100%;
      }

      .icon-container {
        width: 80px;
        height: 80px;
        background: linear-gradient(45deg, var(--accent), #2dd4bf);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1.5rem;
      }

      .icon-container i {
        font-size: 2rem;
        color: white;
      }

      .form-floating .form-control {
        border-radius: 12px;
        border: 1px solid #e1e8ed;
        padding: 1rem 0.75rem;
      }

      .form-floating .form-control:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 0.2rem rgba(62, 226, 192, 0.25);
      }

      .btn-send {
        background: linear-gradient(45deg, var(--accent), #2dd4bf);
        border: none;
        border-radius: 12px;
        padding: 12px 0;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .btn-send:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(62, 226, 192, 0.4);
      }

      .btn-send:disabled {
        background: #6c757d;
        transform: none;
        box-shadow: none;
      }

      .step-indicator {
        display: flex;
        justify-content: center;
        margin-bottom: 2rem;
      }

      .step {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #e9ecef;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 0.5rem;
        font-size: 0.8rem;
        font-weight: 600;
        color: #6c757d;
        transition: all 0.3s ease;
      }

      .step.active {
        background: var(--accent);
        color: white;
      }

      .step.completed {
        background: #28a745;
        color: white;
      }

      .step-line {
        width: 50px;
        height: 2px;
        background: #e9ecef;
        margin: 14px 0;
        transition: all 0.3s ease;
      }

      .step-line.completed {
        background: #28a745;
      }

      .verification-input {
        width: 50px !important;
        height: 50px !important;
        text-align: center;
        font-size: 1.2rem;
        font-weight: 600;
        border-radius: 8px !important;
        margin: 0 0.25rem;
      }

      .alert-custom {
        border-radius: 12px;
        border: none;
        padding: 12px 16px;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      .pulse-animation {
        animation: pulse 2s infinite;
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="nav-lite navbar navbar-expand-lg sticky-top">
      <div class="container-xxl py-2">
        <a class="navbar-brand text-white fw-bold" href="index.html">
          <i class="bi bi-code-square me-2"></i>CODELEARN
        </a>
        <div class="ms-auto d-flex gap-2">
          <a class="btn btn-outline-light" href="index.html">Đăng nhập</a>
          <a class="btn btn-primary" href="register.html">Đăng ký</a>
        </div>
      </div>
    </nav>

    <!-- Forgot Password Form -->
    <div class="forgot-container">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-12">
            <div class="card forgot-card p-4">
              <div class="card-body">
                <!-- Step 1: Enter Email/Phone -->
                <div id="step1" class="step-content">
                  <div class="step-indicator">
                    <div class="step active">1</div>
                    <div class="step-line"></div>
                    <div class="step">2</div>
                    <div class="step-line"></div>
                    <div class="step">3</div>
                  </div>

                  <div class="icon-container">
                    <i class="bi bi-key"></i>
                  </div>

                  <div class="text-center mb-4">
                    <h3 class="fw-bold text-dark mb-2">Khôi phục mật khẩu</h3>
                    <p class="text-muted">
                      Nhập email hoặc số điện thoại để nhận mã xác thực
                    </p>
                  </div>

                  <form id="step1Form">
                    <div class="form-floating mb-3">
                      <input
                        type="text"
                        class="form-control"
                        id="emailOrPhone"
                        placeholder="Email hoặc số điện thoại"
                        required
                      />
                      <label for="emailOrPhone">Email hoặc số điện thoại</label>
                    </div>

                    <div class="d-grid mb-3">
                      <button class="btn btn-send text-white" type="submit">
                        <i class="bi bi-send me-2"></i>Gửi mã xác thực
                      </button>
                    </div>
                  </form>

                  <div class="text-center">
                    <a href="index.html" class="text-decoration-none">
                      <i class="bi bi-arrow-left me-1"></i>Quay lại đăng nhập
                    </a>
                  </div>
                </div>

                <!-- Step 2: Enter Verification Code -->
                <div id="step2" class="step-content d-none">
                  <div class="step-indicator">
                    <div class="step completed">✓</div>
                    <div class="step-line completed"></div>
                    <div class="step active">2</div>
                    <div class="step-line"></div>
                    <div class="step">3</div>
                  </div>

                  <div class="icon-container pulse-animation">
                    <i class="bi bi-shield-check"></i>
                  </div>

                  <div class="text-center mb-4">
                    <h3 class="fw-bold text-dark mb-2">Nhập mã xác thực</h3>
                    <p class="text-muted">
                      Chúng tôi đã gửi mã 6 số đến
                      <span id="sentTo" class="fw-semibold"></span>
                    </p>
                  </div>

                  <form id="step2Form">
                    <div class="d-flex justify-content-center mb-3">
                      <input
                        type="text"
                        class="form-control verification-input"
                        maxlength="1"
                        pattern="[0-9]"
                      />
                      <input
                        type="text"
                        class="form-control verification-input"
                        maxlength="1"
                        pattern="[0-9]"
                      />
                      <input
                        type="text"
                        class="form-control verification-input"
                        maxlength="1"
                        pattern="[0-9]"
                      />
                      <input
                        type="text"
                        class="form-control verification-input"
                        maxlength="1"
                        pattern="[0-9]"
                      />
                      <input
                        type="text"
                        class="form-control verification-input"
                        maxlength="1"
                        pattern="[0-9]"
                      />
                      <input
                        type="text"
                        class="form-control verification-input"
                        maxlength="1"
                        pattern="[0-9]"
                      />
                    </div>

                    <div class="text-center mb-3">
                      <span class="text-muted small">Không nhận được mã? </span>
                      <button
                        type="button"
                        class="btn btn-link p-0 text-decoration-none"
                        id="resendCode"
                        disabled
                      >
                        Gửi lại (<span id="countdown">60</span>s)
                      </button>
                    </div>

                    <div class="d-grid mb-3">
                      <button
                        class="btn btn-send text-white"
                        type="submit"
                        id="verifyBtn"
                        disabled
                      >
                        <i class="bi bi-check-circle me-2"></i>Xác thực
                      </button>
                    </div>
                  </form>

                  <div class="text-center">
                    <button
                      class="btn btn-link text-decoration-none"
                      id="backToStep1"
                    >
                      <i class="bi bi-arrow-left me-1"></i>Thay đổi email/SĐT
                    </button>
                  </div>
                </div>

                <!-- Step 3: Reset Password -->
                <div id="step3" class="step-content d-none">
                  <div class="step-indicator">
                    <div class="step completed">✓</div>
                    <div class="step-line completed"></div>
                    <div class="step completed">✓</div>
                    <div class="step-line completed"></div>
                    <div class="step active">3</div>
                  </div>

                  <div class="icon-container">
                    <i class="bi bi-lock-fill"></i>
                  </div>

                  <div class="text-center mb-4">
                    <h3 class="fw-bold text-dark mb-2">Tạo mật khẩu mới</h3>
                    <p class="text-muted">
                      Mật khẩu mới phải khác với mật khẩu cũ
                    </p>
                  </div>

                  <form id="step3Form">
                    <div class="form-floating mb-3">
                      <input
                        type="password"
                        class="form-control"
                        id="newPassword"
                        placeholder="Mật khẩu mới"
                        required
                      />
                      <label for="newPassword">Mật khẩu mới</label>
                    </div>

                    <div class="form-floating mb-3">
                      <input
                        type="password"
                        class="form-control"
                        id="confirmNewPassword"
                        placeholder="Xác nhận mật khẩu mới"
                        required
                      />
                      <label for="confirmNewPassword"
                        >Xác nhận mật khẩu mới</label
                      >
                      <div
                        class="invalid-feedback"
                        id="confirmPasswordFeedback"
                      ></div>
                    </div>

                    <div class="alert alert-info alert-custom mb-3">
                      <small>
                        <i class="bi bi-info-circle me-2"></i>
                        Mật khẩu cần có ít nhất 8 ký tự, bao gồm chữ hoa, chữ
                        thường và số
                      </small>
                    </div>

                    <div class="d-grid mb-3">
                      <button class="btn btn-send text-white" type="submit">
                        <i class="bi bi-shield-check me-2"></i>Cập nhật mật khẩu
                      </button>
                    </div>
                  </form>
                </div>

                <!-- Success Step -->
                <div id="stepSuccess" class="step-content d-none">
                  <div class="text-center">
                    <div class="icon-container mb-4">
                      <i class="bi bi-check-circle-fill"></i>
                    </div>

                    <h3 class="fw-bold text-success mb-3">Thành công!</h3>
                    <p class="text-muted mb-4">
                      Mật khẩu của bạn đã được cập nhật thành công
                    </p>

                    <div class="d-grid">
                      <a
                        href="index.html"
                        class="btn btn-send text-white text-decoration-none"
                      >
                        <i class="bi bi-box-arrow-in-right me-2"></i>Đăng nhập
                        ngay
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const step1Form = document.getElementById("step1Form");
        const step2Form = document.getElementById("step2Form");
        const step3Form = document.getElementById("step3Form");
        const verificationInputs = document.querySelectorAll(
          ".verification-input"
        );
        const verifyBtn = document.getElementById("verifyBtn");
        const resendBtn = document.getElementById("resendCode");
        let countdownTimer;

        // Step 1: Send verification code
        step1Form.addEventListener("submit", function (e) {
          e.preventDefault();
          const emailOrPhone = document.getElementById("emailOrPhone").value;
          document.getElementById("sentTo").textContent =
            maskEmailOrPhone(emailOrPhone);
          showStep(2);
          startCountdown();
        });

        // Step 2: Verification code handling
        verificationInputs.forEach((input, index) => {
          input.addEventListener("input", function (e) {
            const value = e.target.value;

            if (value && index < verificationInputs.length - 1) {
              verificationInputs[index + 1].focus();
            }

            checkVerificationComplete();
          });

          input.addEventListener("keydown", function (e) {
            if (e.key === "Backspace" && !input.value && index > 0) {
              verificationInputs[index - 1].focus();
            }
          });
        });

        step2Form.addEventListener("submit", function (e) {
          e.preventDefault();

          // Giả lập xác thực thành công
          showStep(3);
        });

        // Step 3: Reset password
        const newPasswordInput = document.getElementById("newPassword");
        const confirmNewPasswordInput =
          document.getElementById("confirmNewPassword");

        confirmNewPasswordInput.addEventListener("input", function () {
          const newPassword = newPasswordInput.value;
          const confirmPassword = this.value;

          if (confirmPassword && newPassword !== confirmPassword) {
            this.classList.add("is-invalid");
            document.getElementById("confirmPasswordFeedback").textContent =
              "Mật khẩu không khớp";
          } else {
            this.classList.remove("is-invalid");
          }
        });

        step3Form.addEventListener("submit", function (e) {
          e.preventDefault();

          if (newPasswordInput.value === confirmNewPasswordInput.value) {
            showStep("success");
          }
        });

        // Resend code
        resendBtn.addEventListener("click", function () {
          startCountdown();
        });

        // Back buttons
        document
          .getElementById("backToStep1")
          .addEventListener("click", function () {
            showStep(1);
            clearCountdown();
          });

        function showStep(stepNumber) {
          document.querySelectorAll(".step-content").forEach((step) => {
            step.classList.add("d-none");
          });

          if (stepNumber === "success") {
            document.getElementById("stepSuccess").classList.remove("d-none");
          } else {
            document
              .getElementById(`step${stepNumber}`)
              .classList.remove("d-none");
          }
        }

        function checkVerificationComplete() {
          const allFilled = Array.from(verificationInputs).every(
            (input) => input.value
          );
          verifyBtn.disabled = !allFilled;
        }

        function startCountdown() {
          let seconds = 60;
          resendBtn.disabled = true;

          countdownTimer = setInterval(() => {
            seconds--;
            document.getElementById("countdown").textContent = seconds;

            if (seconds <= 0) {
              clearInterval(countdownTimer);
              resendBtn.disabled = false;
              resendBtn.innerHTML = "Gửi lại";
            }
          }, 1000);
        }

        function clearCountdown() {
          if (countdownTimer) {
            clearInterval(countdownTimer);
          }
        }

        function maskEmailOrPhone(input) {
          if (input.includes("@")) {
            // Email
            const [username, domain] = input.split("@");
            const maskedUsername =
              username.charAt(0) +
              "*".repeat(username.length - 2) +
              username.charAt(username.length - 1);
            return maskedUsername + "@" + domain;
          } else {
            // Phone number
            return (
              input.substring(0, 3) +
              "*".repeat(input.length - 6) +
              input.substring(input.length - 3)
            );
          }
        }
      });
    </script>
  </body>
</html>
